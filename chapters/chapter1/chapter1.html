<template id="chapter1-template">
  <div id="ch1-ui" class="ch1-container hidden">

    <div id="title-screen" class="screen">
      
      <section id="ch1-medications-panel" class="ch1-panel">
        <div class="ch1-panel-header">
          <span id="ch1-money" class="ch1-money">$ 0</span>
        </div>
        
        <div class="ch1-stats">
          <p id="ch1-total-molecules" class="ch1-stat-line">
            Total de molécules: <span>0</span>
          </p>
          <p id="ch1-med-progress" class="ch1-stat-line ch1-dim">
            Prochain méd: <span>0</span>/<span id="ch1-med-threshold">10</span>
          </p>
        </div>

        <!-- Animation bécher de remplissage -->
        <div id="ch1-beaker-container" class="ch1-beaker-container">
          <div class="ch1-beaker">
            <div id="ch1-beaker-fill" class="ch1-beaker-fill"></div>
            <div class="ch1-beaker-molecules" id="ch1-beaker-molecules"></div>
          </div>
        </div>

        <h3 id="ch1-med-count" class="ch1-med-title">
          MÉDICAMENTS: <span>0</span>
        </h3>

        <div id="ch1-pills-container" class="ch1-pills-grid">
          </div>
      </section>

      <section id="ch1-upgrades-panel" class="ch1-panel">
        
        <div id="ch1-upgrade-0" class="ch1-upgrade" data-index="0">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Production +1</span>
            <span class="ch1-upgrade-cost">$10</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/30</span>
          </div>
          <p class="ch1-upgrade-desc">Produit 1 molécule/s de plus</p>
        </div>

        <div id="ch1-upgrade-1" class="ch1-upgrade" data-index="1">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Durée +2s</span>
            <span class="ch1-upgrade-cost">$15</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/30</span>
          </div>
          <p class="ch1-upgrade-desc">Les médicaments durent 2s de plus</p>
        </div>

        <div id="ch1-upgrade-2" class="ch1-upgrade" data-index="2">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Production x2</span>
            <span class="ch1-upgrade-cost">$50</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/15</span>
          </div>
          <p class="ch1-upgrade-desc">Double la production de molécules</p>
        </div>

        <div id="ch1-upgrade-3" class="ch1-upgrade" data-index="3">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Durée x1.5</span>
            <span class="ch1-upgrade-cost">$75</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/15</span>
          </div>
          <p class="ch1-upgrade-desc">Augmente la durée de 50%</p>
        </div>

        <div id="ch1-upgrade-4" class="ch1-upgrade" data-index="4" style="display: none;">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Bactérie Miroir</span>
            <span class="ch1-upgrade-cost">$10000</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/1</span>
          </div>
          <p class="ch1-upgrade-desc">Mutation ultime : immortalité des médicaments.</p>
        </div>

        <div id="ch1-upgrade-5" class="ch1-upgrade" data-index="5">
          <div class="ch1-upgrade-header">
            <span class="ch1-upgrade-name">Réduction Molécules</span>
            <span class="ch1-upgrade-cost">$20</span>
          </div>
          <div class="ch1-upgrade-info">
            <span class="ch1-upgrade-level">Niveau: 0/9</span>
          </div>
          <p class="ch1-upgrade-desc">Réduit de 1 le nombre de molécules nécessaires par médicament</p>
        </div>

      </section>
    </div>

    <div id="ch1-tutorial-overlay" class="ch1-tutorial-overlay">
      <div id="ch1-tutorial-bubble" class="ch1-tutorial-bubble">
        <div class="ch1-tutorial-title" id="ch1-tutorial-title">Bienvenue</div>
        <div class="ch1-tutorial-content" id="ch1-tutorial-content">
          Contenu du tutoriel...
        </div>
        <div class="ch1-tutorial-actions">
          <button class="ch1-tutorial-btn secondary" id="ch1-tutorial-skip">Passer</button>
          <button class="ch1-tutorial-btn" id="ch1-tutorial-next">Suivant</button>
        </div>
        <div class="ch1-tutorial-arrow down"></div>
      </div>

      <div id="ch1-tutorial-highlight" class="ch1-tutorial-highlight" style="display: none;"></div>

      <div class="ch1-tutorial-progress" id="ch1-tutorial-progress"></div>
    </div>

    <div id="ch1-pipette-animation" class="ch1-pipette-animation">
      <img id="ch1-pipette-img" src="./img/pipette.png" alt="pipette">
    </div>

    <!-- Conteneur pour les animations de médicaments volants -->
    <div id="ch1-flying-meds" class="ch1-flying-meds"></div>

    <!-- Image journal en haut à droite -->
    <div id="ch1-journal-icon" class="ch1-journal-icon">
      <img src="./img/journal_pixel.png" alt="Journal" />
    </div>

  </div>
</template>

<script>
/* Script minimal : active body.no-old-screen quand #ch1-ui est visible, le retire sinon */
(function () {
  function update() {
    const ch = document.getElementById('ch1-ui');
    if (ch && !ch.classList.contains('hidden')) {
      document.body.classList.add('no-old-screen');
    } else {
      document.body.classList.remove('no-old-screen');
    }
  }

  // Observe ajout/suppression d'éléments dans le DOM et changements de classes
  const bodyObserver = new MutationObserver(() => {
    update();
    const ch = document.getElementById('ch1-ui');
    if (ch && !ch._classObserver) {
      ch._classObserver = new MutationObserver(update);
      ch._classObserver.observe(ch, { attributes: true, attributeFilter: ['class'] });
    }
  });
  bodyObserver.observe(document.body, { childList: true, subtree: true });

  // vérification initiale au chargement
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', update);
  } else {
    update();
  }
})();
</script>
